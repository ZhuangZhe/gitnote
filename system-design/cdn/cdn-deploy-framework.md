# CDN的部署架构

CDN系统设计的首要目标是尽量减少用户的访问响应时间，为达到这一目标，CDN系统应该尽量将用户所需要的内容存放在距离用户最近的位置。也就是说，负责为用户提供内容服务的Cache设备应部署在物理上的网络边缘位置，我们称这一层为`CDN边缘层`。CDN系统中负责全局性管理和控制的设备组成`中心层`，中心层同时保存着最多的内容副本，当边缘层设备未命中时，会向中心层请求，如果在中心层仍未命中，则需要中心层向源站回源。

不同CDN系统设计之间存在差异，中心层可能具备用户服务能力，也可能不直接提供服务，只向下级节点提供内容。如果CDN网络规模较大，边缘层设备直接向中心层请求内容或服务会造成中心层设备压力过大，就要考虑在边缘层和中心层之间部署一个`区域层`，负责一个区域的管理和控制，也保存部分内容副本供边缘层访问。

**CDN 节点网络主要包含`CDN骨干点`和`POP点`**

* 中心和区域节点一般称为骨干点，主要作为内容分发和边缘未命中时的服务点。
* 边缘节点又被称为`POP（point-of-presence）节点`，`CDN POP`点主要作为直接向用户提供服务的节点。

**Cache设备和本地负载均衡设备的连接方式有两种**

* 一种是旁路方式
* 一种是穿越方式

在穿越方式下，SLB\(Server Load Balancer\)，负载均衡一般由L4-7交换机实现，SLB向外提供可访问的公网IP地址，每台Cache仅分配私网IP地址，该台SLB下挂的所有Cache构成一个服务组。所有用户请求和媒体流都经过该SLB设备，再由SLB设备进行向上向下转发。SLB实际上承担了NAT\(Network Address Translation，网络地址转换\)功能，向用户屏蔽了Cache设备的IP地址。这种方式是CDN系统中应用较多的方式，优点是具有较高的安全性和可靠性，缺点是L4-7交换机通常较为昂贵。另外，当节点容量大时，L4-7交换机容易形成性能瓶颈。不过近年来，随着 LVS \(Linux Virtual Server，即Linux虚拟服务器\) 等技术的兴起，SLB设备价格有了大幅下降。

**在旁路方式下，有两种SLB实现方式：**

* 在早期，这种SLB一般由软件实现。SLB和Cache设备都具有公共的IP地址，SLB和Cache构成并联关系。用户需要先访问SLB设备，然后再以重定向的方式访问特定的Cache。这种实现方式简单灵活，扩展性好，缺点是安全性较差，而且需要依赖于应用层重定向。
* 随着技术的发展，L4-7 交换机也可采用旁路部署（负载均衡硬件设备的部署）方式，旁挂在路由交换设备上，数据流量通过三角传输方式进行。

在CDN系统中，不仅分发服务系统和调度控制系统是分布式部署的，运营管理系统也是分级分布式部署的，每个节点都是运营管理数据的生成点和采集点，通过日志和网管代理等方式上报数据。**可以说，CDN本身就是一个大型的具有中央控制能力的分布式服务系统。**

