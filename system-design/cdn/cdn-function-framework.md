# CDN的功能架构

**CDN基于这样的原理：**

1. 挑选最优设备为用户提供服务；
2. 如果某个内容被很多用户所需要，它就被缓存到距离用户最近的节点中。

CDN在Cache中复制内容，当内容的提供者更新内容时，CDN向Cache重新分发这些被刷新的内容。CDN提供一种机制，当用户请求内容时，该内容能够由以最快速度交付的Cache来向用户提供，这个挑选"最优"的过程就叫做**负载均衡**。

从功能上划分，典型的 CDN 系统架构由`分发服务系统`、`负载均衡系统`和`运营管理系统`三大部分组成。

## 分发服务系统

该系统的主要作用是实现将内容从内容源中心向边缘的推送和存储，承担实际的内容数据流的全网分发工作和面向最终用户的数据请求服务。分发服务系统最基本的工作单元就是许许多多的Cache，Cache负责直接响应最终用户的访问请求，把缓存在本地的内容快速地提供给用户。同时Cache还负责与源站点进行内容同步，把更新的内容以及本地没有的内容从源站点获取并保存在本地。

一般来说，根据承载内容类型和服务种类的不同，分发服务系统会分为多个子服务系统，如`网页加速子系统`、`流媒体加速子系统`、`应用加速子系统`等。每个子服务系统都是一个分布式服务集群，由一群功能近似的、在地理位置上分布部署的Cache或Cache集群组成，彼此间相互独立。每个子服务系统设备集群的数量根据业务发展和市场需要的不同，少则几十台，多则可达上万台，对外形成一个整体，共同承担分发服务工作。**Cache 设备的数量、规模、总服务能力是衡量一个 CDN 系统服务能力的最基本的指标。**

分发服务系统在承担内容的更新、同步和响应用户需求的同时，还需要向上层的调度控制系统提供每个Cache设备的**健康状况信息、响应情况**，有时还需要提供内容分布信息，以便调度控制系统根据设定的策略决定由哪个Cache\(组\)来响应用户的请求最优。

`静态内容加速` + `动态内容加速` + `流媒体加速` + `应用协议加速` + `日志采集`

## 负载均衡系统

负载均衡系统是一个CDN系统的神经中枢，主要功能是负责对所有发起服务请求的用户进行访问调度，确定提供给用户的最终实际访问地址。大多数CDN系统的负载均衡系统是分级实现的，这里以最基本的两级调度体系进行简要说明。一般而言，两级调度体系分为`全局负载均衡(GSLB)`和`本地负载均衡(SLB)`。

其中，GSLB主要根据**用户就近性原则**，通过对每个服务节点进行"最优"判断，确定向用户提供服务的Cache的物理位置。最通用的GSLB实现方法是基于`DNS解析`的方式实现，也有一些系统采用了`应用层重定向`等方式来解决。SLB主要负责节点内部的设备负载均衡，当用户请求从GSLB调度到SLB时，SLB会根据节点内各Cache设备的实际能力或内容分布等因素对用户进行重定向，常用的本地负载均衡方法有`基于4层调度`、`基于7层调度`、`链路负载调度`等。

`域名解析/全局负载均衡` + `区域负载均衡` + `本地负载平衡` + `流量管理`

## 运营管理系统

CDN的运营管理系统与一般的电信运营管理系统类似，分为运营管理和网络管理两个子系统。

运营管理子系统是CDN系统的业务管理功能实体，负责处理业务层面的与外界系统交互所必需的一些收集、整理、交付工作，包含客户管理、产品管理、计费管理、统计分析等功能。

网络管理子系统实现对CDN系统的**网络设备管理、拓扑管理、链路监控和故障管理**，为管理员提供对全网资源进行集中化管理操作的界面，通常是基于Web方式实现的。

`客户管理` + `业务管理` + `计费管理` + `数据采集`

